<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Access Nature - Making outdoor spaces accessible for everyone">
  <title>Access Nature - Making Trails Accessible</title>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ²</text></svg>">
  
  <!-- External CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
  
  <!-- NEW: UI Polish CSS -->
  <link rel="stylesheet" href="src/css/ui-polish.css">
  
  <!-- EXISTING: Your App CSS -->
  <link rel="stylesheet" href="src/css/landing.css">
  <link rel="stylesheet" href="src/css/auth.css">
</head>
<body>

  <!-- NEW: Mobile-First Top Navigation -->
  <nav class="top-nav">
  <!-- Brand/Logo -->
  <a href="index.html" class="nav-brand">
    <span class="nav-brand-icon">ğŸŒ²</span>
    <span>Access Nature</span>
  </a>

  <!-- Hamburger Menu Button -->
  <button 
    class="menu-toggle" 
    id="menuToggle" 
    aria-label="Toggle navigation menu"
    aria-expanded="false"
    aria-controls="navMenu"
  >
    <div class="hamburger-icon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </button>

  <!-- Navigation Menu -->
  <div class="nav-menu" id="navMenu">
    <a href="index.html" class="nav-link">
      <span class="nav-icon">ğŸ </span>
      <span class="nav-label">Home</span>
    </a>

    <a href="tracker.html" class="nav-link">
      <span class="nav-icon">ğŸ“</span>
      <span class="nav-label">Track Trail</span>
    </a>

    <a href="#" onclick="openTrailBrowser(); return false;" class="nav-link">
      <span class="nav-icon">ğŸ”</span>
      <span class="nav-label">Browse Trails</span>
    </a>

    <button class="nav-link" id="authNavBtn">
      <span class="nav-icon">ğŸ‘¤</span>
      <span class="nav-label">Sign In</span>
    </button>
  </div>
</nav>

  <!-- EXISTING: Hero Section -->
  <div class="hero-section">
    <div class="hero-background"></div>
    <div class="hero-content">
      <h1 class="hero-title">ğŸŒ² Access Nature</h1>
      <p class="hero-subtitle">Making outdoor spaces accessible for everyone</p>
      
      <!-- EXISTING: Auth Status (kept for backward compatibility) -->
      <div id="authStatusBar" class="auth-status-landing">
        <div id="userInfo" class="user-info hidden">
          <span class="user-greeting">Welcome back, <span id="userEmail"></span>!</span>
          <button id="logoutBtn" class="auth-btn logout-btn">Logout</button>
        </div>
        <div id="authPrompt" class="auth-prompt">
          <button id="showAuthBtn" class="auth-btn login-btn">Sign In</button>
        </div>
      </div>
    </div>
  </div>

  <!-- EXISTING: Debug Tools (keep for development) -->
  <div style="position: fixed; top: 80px; right: 20px; z-index: 9999; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 10px;">
    <button onclick="debugTrailGuides()" style="background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 5px; margin: 2px;">
      ğŸ” Check Guides
    </button>
    <button onclick="makeGuidesPublic()" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; margin: 2px;">
      ğŸŒ Make Public
    </button>
  </div>

  <!-- EXISTING: Main Navigation -->
  <div class="main-navigation">
    <div class="nav-container">
      
      <!-- Search Trail Guides -->
      <div class="nav-card discover-card">
        <div class="nav-card-icon">ğŸ”</div>
        <h2>Discover Accessible Trails</h2>
        <p>Browse community-contributed accessible trail guides with detailed accessibility information, photos, and reviews.</p>
        
        <div class="nav-card-features">
          <span class="feature-tag">â™¿ Wheelchair Access</span>
          <span class="feature-tag">ğŸ“· Photos & Notes</span>
          <span class="feature-tag">â­ Community Reviews</span>
          <span class="feature-tag">ğŸ—ºï¸ Interactive Maps</span>
        </div>
        
        <button class="nav-card-button primary" onclick="openTrailBrowser()">
          ğŸ” Browse Trail Guides
        </button>
        
        <div class="quick-search">
          <input type="text" id="quickSearch" placeholder="Quick search trails..." maxlength="50">
          <button onclick="quickSearch()" class="search-btn">Search</button>
        </div>
      </div>

      <!-- Track New Trail -->
      <div class="nav-card track-card">
        <div class="nav-card-icon">ğŸ“</div>
        <h2>Map a New Trail</h2>
        <p>Use GPS tracking to document new accessible routes. Record accessibility features, take photos, and create trail guides for the community.</p>
        
        <div class="nav-card-features">
          <span class="feature-tag">ğŸ“± GPS Tracking</span>
          <span class="feature-tag">ğŸ“ Accessibility Survey</span>
          <span class="feature-tag">ğŸ“· Photo Documentation</span>
          <span class="feature-tag">â˜ï¸ Cloud Sync</span>
        </div>
        
        <button class="nav-card-button secondary" onclick="openTracker()">
          ğŸ“ Start Tracking
        </button>
        
        <div class="tracker-stats">
          <div class="stat-item">
            <span class="stat-number" id="totalRoutes">0</span>
            <span class="stat-label">Routes Mapped</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="totalDistance">0</span>
            <span class="stat-label">km Documented</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- EXISTING: Community Stats Section -->
  <div class="community-section">
    <div class="community-container">
      <h3>ğŸŒ Community Impact</h3>
      <div class="community-stats">
        <div class="community-stat">
          <span class="stat-big" id="publicGuides">0</span>
          <span class="stat-desc">Public Trail Guides</span>
        </div>
        <div class="community-stat">
          <span class="stat-big" id="totalKm">0</span>
          <span class="stat-desc">Kilometers Mapped</span>
        </div>
        <div class="community-stat">
          <span class="stat-big" id="accessibleTrails">0</span>
          <span class="stat-desc">Wheelchair Accessible</span>
        </div>
        <div class="community-stat">
          <span class="stat-big" id="totalUsers">0</span>
          <span class="stat-desc">Contributors</span>
        </div>
      </div>
    </div>
  </div>

  <!-- EXISTING: Featured Trails -->
  <div class="featured-section">
    <div class="featured-container">
      <h3>â­ Featured Accessible Trails</h3>
      <div id="featuredTrails" class="featured-grid">
        <!-- Dynamically populated -->
      </div>
      <button class="load-more-btn" onclick="loadMoreFeatured()">Load More Trails</button>
    </div>
  </div>

  <!-- EXISTING: Footer -->
  <footer class="footer-section">
    <div class="footer-container">
      <div class="footer-content">
        <div class="footer-brand">
          <h4>ğŸŒ² Access Nature</h4>
          <p>Making outdoor spaces accessible for everyone</p>
        </div>
        <div class="footer-links">
          <a href="#" onclick="showAbout(); return false;">About</a>
          <a href="#" onclick="showPrivacy(); return false;">Privacy</a>
          <a href="#" onclick="showContact(); return false;">Contact</a>
          <a href="#" onclick="showHelp(); return false;">Help</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 Access Nature. Making trails accessible for all abilities.</p>
      </div>
    </div>
  </footer>

  <!-- EXISTING: Trail Browser Modal -->
  <div id="trailBrowserModal" class="modal hidden">
    <div class="modal-backdrop" onclick="closeTrailBrowser()"></div>
    <div class="modal-container trail-browser">
      <div class="modal-header">
        <h2>ğŸ” Browse Accessible Trails</h2>
        <button class="modal-close" onclick="closeTrailBrowser()">âœ•</button>
      </div>
      
      <div class="modal-content">
        <!-- Search and Filters -->
        <div class="search-section">
          <div class="search-bar">
            <input type="text" id="trailSearch" placeholder="Search trail names, locations..." maxlength="100">
            <button onclick="searchTrails()" class="search-button">ğŸ” Search</button>
          </div>
          
          <div class="filters-section">
            <h4>ğŸ¯ Filter by Accessibility</h4>
            <div class="filter-grid">
              <select id="wheelchairFilter">
                <option value="">Wheelchair Access</option>
                <option value="Fully Accessible">Fully Accessible</option>
                <option value="Partially Accessible">Partially Accessible</option>
                <option value="Not Accessible">Not Accessible</option>
              </select>
              
              <select id="difficultyFilter">
                <option value="">Difficulty Level</option>
                <option value="Easy">Easy</option>
                <option value="Moderate">Moderate</option>
                <option value="Difficult">Difficult</option>
              </select>
              
              <select id="distanceFilter">
                <option value="">Distance</option>
                <option value="0-2">0-2 km</option>
                <option value="2-5">2-5 km</option>
                <option value="5-10">5-10 km</option>
                <option value="10+">10+ km</option>
              </select>
              
              <button onclick="applyFilters()" class="filter-apply-btn">Apply Filters</button>
            </div>
          </div>
        </div>
        
        <!-- Results -->
        <div class="results-section">
          <div class="results-header">
            <h4>ğŸ“ Trail Results</h4>
            <span id="resultsCount">0 trails found</span>
          </div>
          
          <div id="trailResults" class="trail-results-grid">
            <!-- Dynamically populated -->
          </div>
          
          <div class="results-pagination">
            <button id="loadMoreBtn" onclick="loadMoreResults()" class="load-more-btn hidden">
              Load More Trails
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- EXISTING: Auth Modal -->
  <div id="authModal" class="auth-modal hidden">
  <div class="auth-modal-backdrop" onclick="closeAuthModal()"></div>
  <div class="auth-modal-container">
    <div class="auth-modal-header">
      <h2 id="authModalTitle">Welcome to Access Nature</h2>
      <button class="auth-modal-close" onclick="closeAuthModal()">âœ•</button>
    </div>
    
    <div class="auth-modal-content">
      <!-- Login Form -->
      <div id="loginForm" class="auth-form active">
        <div class="auth-form-header">
          <h3>Sign In to Your Account</h3>
          <p>Continue your accessibility mapping journey</p>
        </div>
        
        <form class="auth-inputs">
          <div class="input-group">
            <input type="email" id="loginEmail" placeholder="Email address" required>
            <span class="input-icon">ğŸ“§</span>
          </div>
          
          <div class="input-group">
            <input type="password" id="loginPassword" placeholder="Password" required>
            <span class="input-icon">ğŸ”’</span>
          </div>
          
          <button type="submit" id="loginBtn" class="auth-submit-btn">
            <span class="btn-text">Sign In</span>
            <span class="btn-spinner hidden">â³</span>
          </button>
        </form>
        
        <div class="auth-divider">
          <span>or</span>
        </div>
        
        <button id="googleLoginBtn" class="google-btn">
          <span>Continue with Google</span>
        </button>
        
        <div class="auth-switch">
          <p>Don't have an account? <button type="button" onclick="switchToSignup()" class="switch-btn">Sign up</button></p>
        </div>
      </div>

      <!-- Signup Form -->
      <div id="signupForm" class="auth-form">
        <div class="auth-form-header">
          <h3>Create Your Account</h3>
          <p>Join the accessibility mapping community</p>
        </div>
        
        <form class="auth-inputs">
          <div class="input-group">
            <input type="email" id="signupEmail" placeholder="Email address" required>
            <span class="input-icon">ğŸ“§</span>
          </div>
          
          <div class="input-group">
            <input type="password" id="signupPassword" placeholder="Password (min 6 characters)" required>
            <span class="input-icon">ğŸ”’</span>
          </div>
          
          <div class="input-group">
            <input type="password" id="confirmPassword" placeholder="Confirm password" required>
            <span class="input-icon">ğŸ”’</span>
          </div>
          
          <button type="submit" id="signupBtn" class="auth-submit-btn">
            <span class="btn-text">Create Account</span>
            <span class="btn-spinner hidden">â³</span>
          </button>
        </form>
        
        <div class="auth-divider">
          <span>or</span>
        </div>
        
        <button id="googleSignupBtn" class="google-btn">
          <span>Continue with Google</span>
        </button>
        
        <div class="auth-switch">
          <p>Already have an account? <button type="button" onclick="switchToLogin()" class="switch-btn">Sign in</button></p>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- NEW: UI Polish JavaScript - Load BEFORE your app scripts -->
  <script src="src/js/navigation.js"></script>
  <script src="src/js/toast.js"></script>
  <script src="src/js/loading.js"></script>
  <script src="src/js/modal.js"></script>

  <!-- Firebase Setup -->
  <script type="module" src="./firebase-setup.js"></script>
  
  <!-- EXISTING: Your App JavaScript -->
  <script type="module" src="src/landing.js"></script>
  <script type="module" src="src/features/auth.js"></script>

  <!-- NEW: Complete Bridge Script with ALL function handlers -->
  <script>
    // ===========================================
    // GLOBAL FUNCTION DEFINITIONS
    // These ensure buttons work even if landing.js takes time to load
    // ===========================================

    // Debug functions (EXISTING - from your original HTML)
    async function debugTrailGuides() {
      try {
        const { collection, getDocs, query, limit } = await import("https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js");
        const { db } = await import("./firebase-setup.js");
        
        const guidesQuery = query(collection(db, 'trail_guides'), limit(20));
        const snapshot = await getDocs(guidesQuery);
        
        console.log('ğŸ“Š TOTAL GUIDES:', snapshot.size);
        alert(`Found ${snapshot.size} trail guides total`);
        
        if (snapshot.size > 0) {
          snapshot.forEach(doc => {
            const data = doc.data();
            console.log('ğŸ“„', data.routeName, '- Public:', data.isPublic, '- User:', data.userEmail);
          });
        }
      } catch (error) {
        console.error('âŒ Debug failed:', error);
        alert('Debug failed: ' + error.message);
      }
    }

    async function makeGuidesPublic() {
      try {
        const { collection, getDocs, query, doc, updateDoc } = await import("https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js");
        const { db, auth } = await import("./firebase-setup.js");
        
        if (!auth.currentUser) {
          alert('Please sign in first!');
          return;
        }
        
        const guidesQuery = query(collection(db, 'trail_guides'));
        const snapshot = await getDocs(guidesQuery);
        
        let updated = 0;
        const promises = [];
        
        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          if (data.userId === auth.currentUser.uid && !data.isPublic) {
            promises.push(updateDoc(doc(db, 'trail_guides', docSnap.id), {
              isPublic: true,
              publishedAt: new Date().toISOString()
            }));
            updated++;
          }
        });
        
        if (promises.length === 0) {
          alert('No private guides found to make public!');
          return;
        }
        
        await Promise.all(promises);
        alert(`âœ… Made ${updated} guides public!`);
        
      } catch (error) {
        console.error('âŒ Failed:', error);
        alert('Failed: ' + error.message);
      }
    }

    // Navigation functions - Fallbacks that will be overridden by landing.js
    function openTracker() {
      console.log('ğŸ“ Opening tracker...');
      window.location.href = 'tracker.html';
    }

    function openTrailBrowser() {
      console.log('ğŸ” Opening trail browser...');
      const modal = document.getElementById('trailBrowserModal');
      if (modal) {
        modal.classList.remove('hidden');
      }
    }

    function closeTrailBrowser() {
      console.log('âŒ Closing trail browser...');
      const modal = document.getElementById('trailBrowserModal');
      if (modal) {
        modal.classList.add('hidden');
      }
    }

    function quickSearch() {
      console.log('ğŸ” Quick search triggered...');
      const query = document.getElementById('quickSearch')?.value;
      if (query && query.trim()) {
        openTrailBrowser();
        const trailSearch = document.getElementById('trailSearch');
        if (trailSearch) {
          trailSearch.value = query;
          // Try to call searchTrails if it exists
          setTimeout(() => {
            if (typeof searchTrails === 'function') {
              searchTrails();
            }
          }, 100);
        }
      } else {
        const message = 'Please enter a search term';
        if (typeof toast !== 'undefined') {
          toast.warning('Search Empty', message);
        } else {
          alert(message);
        }
      }
    }

    // Trail search and filter functions - Fallbacks
    function searchTrails() {
      console.log('ğŸ” Searching trails...');
      // Check if landing.js has loaded and override this
      if (window.LandingPageController && window.LandingPageController.searchTrails) {
        window.LandingPageController.searchTrails();
      } else {
        console.log('â³ LandingPageController not ready yet, search will execute when ready');
      }
    }

    function applyFilters() {
      console.log('ğŸ¯ Applying filters...');
      if (window.LandingPageController && window.LandingPageController.applyFilters) {
        window.LandingPageController.applyFilters();
      } else {
        console.log('â³ LandingPageController not ready yet, filters will apply when ready');
      }
    }

    function loadMoreResults() {
      console.log('ğŸ“ Loading more results...');
      if (window.LandingPageController && window.LandingPageController.loadMoreResults) {
        window.LandingPageController.loadMoreResults();
      } else {
        console.log('â³ LandingPageController not ready yet');
      }
    }

    // FIXED: loadMoreFeatured function
    function loadMoreFeatured() {
      console.log('â­ Loading more featured trails...');
      if (window.LandingPageController && window.LandingPageController.loadMoreFeatured) {
        window.LandingPageController.loadMoreFeatured();
      } else {
        console.log('â³ LandingPageController not ready yet, featured trails will load when ready');
        const message = 'Loading trail guides...';
        if (typeof toast !== 'undefined') {
          toast.info('Please Wait', message);
        } else {
          console.log(message);
        }
      }
    }

    // Footer links
    function showAbout() {
      if (typeof modal !== 'undefined') {
        modal.alert({
          title: 'About Access Nature',
          message: 'Access Nature is a community-driven platform dedicated to making outdoor spaces accessible for everyone. We provide tools to document and share accessibility information about trails worldwide.'
        });
      } else {
        alert('Access Nature is a community-driven platform dedicated to making outdoor spaces accessible for everyone.');
      }
    }

    function showPrivacy() {
      if (typeof modal !== 'undefined') {
        modal.alert({
          title: 'Privacy Policy',
          message: 'Your privacy is important to us. We only collect data necessary to provide our services and never sell your information to third parties.'
        });
      } else {
        alert('Your privacy is important to us. We only collect data necessary to provide our services.');
      }
    }

    function showContact() {
      if (typeof modal !== 'undefined') {
        modal.alert({
          title: 'Contact Us',
          message: 'Email: support@accessnature.org\n\nWe\'d love to hear from you!'
        });
      } else {
        alert('Email: support@accessnature.org');
      }
    }

    function showHelp() {
      if (typeof modal !== 'undefined') {
        modal.alert({
          title: 'Help & Support',
          message: 'Need help? Check out our documentation or contact support at support@accessnature.org'
        });
      } else {
        alert('Need help? Contact support at support@accessnature.org');
      }
    }

    // Connect auth button in new navigation
    document.addEventListener('DOMContentLoaded', () => {
      const authNavBtn = document.getElementById('authNavBtn');
      const authNavLabel = document.getElementById('authNavLabel');
      
      if (authNavBtn && authNavLabel) {
        authNavBtn.addEventListener('click', () => {
          const showAuthBtn = document.getElementById('showAuthBtn');
          const logoutBtn = document.getElementById('logoutBtn');
          
          if (showAuthBtn && !showAuthBtn.closest('.hidden')) {
            showAuthBtn.click();
          } else if (logoutBtn && !logoutBtn.closest('.hidden')) {
            logoutBtn.click();
          }
        });

        // Update label based on auth state
        const observer = new MutationObserver(() => {
          const userInfo = document.getElementById('userInfo');
          if (userInfo && !userInfo.classList.contains('hidden')) {
            authNavLabel.textContent = 'Sign Out';
          } else {
            authNavLabel.textContent = 'Sign In';
          }
        });

        const authStatusBar = document.getElementById('authStatusBar');
        if (authStatusBar) {
          observer.observe(authStatusBar, { 
            attributes: true, 
            childList: true, 
            subtree: true 
          });
        }
      }

      // Log when functions are ready
      console.log('âœ… Global functions initialized:', {
        openTracker: typeof openTracker === 'function',
        openTrailBrowser: typeof openTrailBrowser === 'function',
        closeTrailBrowser: typeof closeTrailBrowser === 'function',
        quickSearch: typeof quickSearch === 'function',
        searchTrails: typeof searchTrails === 'function',
        applyFilters: typeof applyFilters === 'function',
        loadMoreResults: typeof loadMoreResults === 'function',
        loadMoreFeatured: typeof loadMoreFeatured === 'function'
      });
    });
  </script>

</body>
</html>